#==============================================================================================================================#
#
#    @file	Makefile
#
#    @date	2022/10/02
#    @author	Thomas Gijsbers
#
#    @copyright       ©	2022 ― Thomas Gijsbers
#			All rights reserved.
#
#==============================================================================================================================#


#==============================================================================================================================#
ifndef $(TARGET)
    include		config.mk
else
    TARGET		:= debug
endif
#==============================================================================================================================#
#    ==~*=+*=*=~*~=~~=~=+~+*=*+*+~==**~*=*=++=~++===~*==~~~+*+++***=+~==~~=++++~*~=~=+~+*=**~+=*+**+++=*==***+~*~====+=~***    #
#==============================================================================================================================#
ifneq ($(TARGET),)
    VERSION_SUFFIX	:= $(VERSION_SUFFIX)-$(TARGET)
endif
#==============================================================================================================================#
#    =+=*~==*===++~**=~~=*~*~=+**=+~=**=*~**~+*~+~=~~+=~=++=~*=~+*~+=~=~****++*++~~++=*~===~=*~+=*~~*=~+~~~~~=***==+~*=+++~    #
#==============================================================================================================================#
ifneq ($(VERSION),)
    VERSION_SUFFIX	:= $(VERSION_SUFFIX)_$(VERSION)
endif
#==============================================================================================================================#
#    *~+~=**==*~++=*++*~~~~+*~=~~*===~+==+*+~+~+++~*=+=*==*~++~=+*~~=~+**==+~=~++==+===~~~===+=+~=**~=~=*====~~+~~=*~+*~=+=    #
#==============================================================================================================================#
ifneq ($(PLATFORM),)
    VERSION_SUFFIX	:= $(VERSION_SUFFIX)_$(PLATFORM)
endif
#==============================================================================================================================#
#    +=*+~*~+~=*==+=~*=++~~~=*~=+~+~=~*==+~~+~+*~=*~=*~*~+*~=*~~==*~*~~+*~*=*=*~=~*+~~=~=+===**+**=**~=*=*~~=*+**++~~~*=**=    #
#==============================================================================================================================#
ifneq ($(ARCHITECTURE),)
    VERSION_SUFFIX	:= $(VERSION_SUFFIX)-$(ARCHITECTURE)
endif
#==============================================================================================================================#
#	^^__^^^___^^___^_^^_^__^^____^___^^^^^___^_^^_^^_^_^_^_^_____^___^^_^_^^_______^___^_^_^^______^^_^^_^_^_^_^^^__       #
#	^_^__^______^^____^^_____^_____^^_^_^^__^_^^_^__^^_^^_^^___^^_____^^^^^_^__^^^____^^_^^_^_^_^^_^^^_^^^^^^^^_^_^_       #
#==============================================================================================================================#
EXE		=	game$(VERSION_SUFFIX)
#==============================================================================================================================#
ifeq ($(OS),Windows_NT)
    EXE		:=	$(EXE).exe
endif
#==============================================================================================================================#
BINDIR		= 	$(PREFIX)bin
OBJDIR		= 	$(PREFIX)obj
#==============================================================================================================================#
GENERATED_DIRS	= 	$(BINDIR) $(OBJDIR)
#==============================================================================================================================#
LIBDIR		= 	$(PREFIX)lib
#==============================================================================================================================#
SRCDIR		= 	$(PREFIX)src
INCDIR		= 	$(PREFIX)include
#==============================================================================================================================#
SOURCES		= 	$(shell find $(SRCDIR) | grep -i '\.c$$')
OBJECTS		= 	$(SOURCES:src/%.c=obj/%.o)
#==============================================================================================================================#
ifeq ($(TARGET),release)
#==============================================================================================================================#
    LD_OPTIONS		+=	-s
    CC_OPTFLAG		:=	-O2
#==============================================================================================================================#
else #debug
#==============================================================================================================================#
    CC_DEFINES		:=	-D_DEBUG
    CC_OPTFLAG		:=	-O0 -g
#==============================================================================================================================#
endif
#==============================================================================================================================#
#	_^_^__^__^^^_^_^_^^__^_^^__^^______^^___^^^^^___^_^__^^^_^_____^____^^_^_^_^_^_^^^______^__^_^^^____^^__^^__^^^_       #
#==============================================================================================================================#
LDFLAGS		=	$(LD_LIBDIRS) $(LD_LIBS) $(LD_OPTIONS)
CCFLAGS		=	$(CC_INCDIRS) $(CC_OPTFLAG) $(CC_DEFINES) $(CC_OPTIONS)
#==============================================================================================================================#
#	^__^_^^_^__^^____^____^______^^^^_^^^__^^____^_^_____^^____^^^^^__^^^^^^^_^^^^^__^^__^__^_^^^^^^^___^^__^^^___^^       #
#	_^^^____^^____^^^^_____^^^___^_^^_^__^_^^^_^___^_^_____^_^^_^^____^^^___^____^___^^_^^____^_^____^^_^^_^^_^_^_^_       #
#==============================================================================================================================#
default:		all
#==============================================================================================================================#
all:			dirs executable
#==============================================================================================================================#
#    *+*~*~+*+*+=~~~***=*~=~=~=+=~~~++~=+~~~==~=+~~=*~+~=**+*~+**~**=*+*=+*+~~~~==+~**=++~+~=+*+~=++~**+=*~*~==~*~~==*+=**+    #
#==============================================================================================================================#
dirs:			$(GENERATED_DIRS)
#==============================================================================================================================#
$(GENERATED_DIRS):
	mkdir	-p $@
#==============================================================================================================================#
#    *=+~*+=+=+=***~++~*++~~*==*++*+=~=~+*=++****=***++~+~~==+=*~*~++=**~+~~*+=+**==*+=~=*~*=~~=+~=+=*+~+*+**~***+=+**~+=+=    #
#==============================================================================================================================#
executable:		$(EXE)
$(BINDIR)/$(EXE):	$(OBJECTS)
	$(CC)	$^ $(LDFLAGS) -o $@
#==============================================================================================================================#
#    ~=+**+++=+***~**~~~===+=~~+~==++=+*+=+~*+~+**=+**=~~+=*~~+*~++++*=*+~*==*~*=*=+***++~=+=*+=~*~~+*~=~~=*~+**==~*=**~=++    #
#==============================================================================================================================#
$(EXE):			$(BINDIR)/$(EXE)
	ln	-s $< $@
ifeq	($(TARGET),release)
	strip	$@
endif
#==============================================================================================================================#
#    *=*+~**~==*~*+=*~*+==+*+~*=+*~=+~~++**=++*=~~**~**=*~+*+=++**+~~*++*~+=*++*****+~~*=++**~~+==+==**+**+*+~====*+=*=~~==    #
#==============================================================================================================================#
objects:		$(OBJECTS)
#==============================================================================================================================#
obj/%.o:		src/%.c
	$(CC)	$< $(CCFLAGS) -c -o $@
#==============================================================================================================================#
#	_^^_____^^_^__^_^^^_^^___^_^__^_^_^_^__^^_^____^____^^_^^^^___^__^^_^^^__^^__^^^_^^^^_^__^__^^_^__^^_^_^^^^__^_^       #
#	^_^_^__^^^_^_^^_____^___^^___^______^__^__^^___^^____^^^^_^^^^^_^^^^__^^__^__^^___^__^^___^_^^^__^^^__^^____^^^_       #
#==============================================================================================================================#
.PHONY:			clean
#==============================================================================================================================#
clean:
	-rm -R $(GENERATED_DIRS) $(EXE)

#==============================================================================================================================#
# ^%%#@&#&^^@$%#&^#$&@&*!^$^@*$#*^%&*$@@%!*$@!*!!@@@$**!*!^$$^!$%#@##$$$^%@&*^!$^*@!@%#@!$&*%@#*%!#^*$$!@%^$%$@!*#&^#$!#@$%!#$ #
# *&%$@%*$#!^&*#@!$#%!^%**@@*@%#!^$!%#!#*@*@*%!*^^@%*^*@!@@#@@%^$#!$##@#@@@@^&@$%%#%#%*%%*&%!%^^&^$@&*&$#&###!*!%@@*$%!&&$#&!* #
#==============================================================================================================================#
